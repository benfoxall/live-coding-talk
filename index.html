<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>Live Coding</title>

    <meta name="description" content="A talk about stuff">
    <meta name="author" content="Ben Foxall (@benjaminbenben)">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <!-- <link href="https://fonts.googleapis.com/css?family=Fredoka+One" rel="stylesheet"> -->

    <link rel="stylesheet" href="bower_components/reveal.js/css/reveal.css">
    <link rel="stylesheet" href="theme/pusher.css" id="theme">

    <!-- Code syntax highlighting -->
    <!-- <link rel="stylesheet" href="bower_components/reveal.js/lib/css/zenburn.css"> -->
    <link rel="stylesheet" href="tomorrow.css">
    <style media="screen">
      .reveal pre {box-shadow: none;padding:.5em}
    </style>

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'bower_components/reveal.js/css/print/pdf.css' : 'bower_components/reveal.js/css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->

    <style media="screen">
      .deet-error {
        border-top: 3vh solid red
      }
    </style>

  </head>

  <body>

    <div class="reveal">

      <div class="slides">

        <section>
          <h3>‚Ä¶</h3>
          <p>
            <a href="https://www.cojs.co/api/details">deets &rarr;</a>
            <input type="txt" id="deets" value="" data-persist="deets" style="font-size:1em">
          </p>
        </section>

        <section>


          <section>
            <h1>Hello Frontier</h1>
            <h2 class="fragment">üëè Adam, John &amp; everyone </h2>
          </section>

          <section>
            <h1>I'm Ben</h1>
            <h5><a href="https://twitter.com/benjaminbenben">@benjaminbenben</a></h5>
          </section>

          <section data-background="#27343d">
            <img src="img/pusher_logo_white.svg" class="stretch" />
          </section>

          <!-- <section>
            <img src="img/jsoxford.svg" class="stretch" />
          </section>

          <section>
            <img src="img/render.png" class="stretch" />
            <h4>render-conf.com</h4>
          </section> -->

        </section>

        <section>

          <section>
            <h1>Live Coding<br />Across Devices</h1>
          </section>

          <section>
            <h1>Live Coding</h1>
          </section>

          <section>
            <h2>Automatically evaluated code</h2>
          </section>

          <section>
            <h3>For efficiency, focus &amp; exploration</h3>
            <h4 class="fragment">Also, performance &amp; art</h4>
          </section>

          <section>
            <h1>Across Devices</h1>
          </section>

          <section>
            <h2>Executes on many devices</h2>
          </section>

          <section>
            <h3>For testing, collaboration, learning <br />&amp; because it's kind of fun</h3>
          </section>

        </section>

        <section>
          <section>
            <h1>cojs<span style="opacity:0.2">.co</span></h1>
          </section>

          <section>
              <img src="img/code-along.png" class="stretch" />
          </section>

          <section>
            <div class="image-4grid">
              <img src="img/example-codepen.png"/>
              <img src="img/example-jsbin.png"/>
              <img src="img/example-jsfiddle.png"/>
              <!-- <img src="img/example-requirebin.png"/> -->
            </div>
          </section>
          <style media="screen">
            .image-4grid img { width: 40%; }
          </style>
        </section>

        <section>
          <section>
            <h1>Features</h1>
          </section>

          <section
            data-background="img/feature-es2015.png"
            data-background-size="110vh"
            data-background-position="50% 122%">
            <h3>1. ES2015</h3>
          </section>

          <section
            data-background="img/feature-modules.png"
            data-background-size="110vh"
            data-background-position="50% 122%">
            <h3>2. Multiple files</h3>
          </section>

          <section
            data-background="img/feature-connection.png"
            data-background-size="110vh"
            data-background-position="50% 122%">
            <h3>3. Connected</h3>
          </section>

        </section>

        <section>
          <section>
            <h1>How it works</h1>
          </section>

          <section>
              <img src="img/technically.png" class="stretch" />
          </section>

          <section>

            <h3>For people who like code stuff</h3>
            <pre><code>rollup.rollup({
  entry: 'main.js',
  load: id => files[name] || Promise.reject("not found"),
  transformBundle: buble.transform(d).code
}).then(
  bundle => bundle.generate({ format: 'iife' }).code
).then(
  js => '&lt;html&gt;‚Ä¶ &lt;script&gt;' + js + '&lt;/script&gt;'
).then(
  htm => new Blob([htm], {type: 'text/html'})
).then(
  blob => URL.createObjectURL(blob)
).then(
  url => iframe.src = url
)</code></pre>
          </section>


        </section>

        <section>
          <section>
            <h1>What it can do</h1>
          </section>

          <section>
            <svg id="single" width="960px" height="700px" viewBox="0 0 600 454" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                <g>
                    <rect fill="#FFFFFF" x="28.3743842" y="59.1133005" width="543.251232" height="350.541872"></rect>
                    <image x="0" y="0" width="600" height="453.399015" xlink:href="img/chrome-outline.png"></image>
                    <text font-family="RobotoMonoForPowerline-Light, Roboto Mono Light for Powerline" font-size="45" font-weight="300" fill="#000000">
                        <tspan x="109.991211" y="230">#eee</tspan>
                    </text>
                    <rect fill="#EEEEEE" x="300" y="59.1133005" width="271.625616" height="350.541872"></rect>
                </g>
            </svg>
          </section>

          <section>

            <svg id="panels" width="960px" height="700px" viewBox="0 0 600 454" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                <g>
                    <rect fill="#FFFFFF" x="28.3743842" y="59.1133005" width="543.251232" height="350.541872"></rect>
                    <image x="0" y="0" width="600" height="453.399015" xlink:href="img/chrome-outline.png"></image>
                    <text font-family="RobotoMonoForPowerline-Light, Roboto Mono Light for Powerline" font-size="45" font-weight="300" fill="#000000">
                        <tspan x="109.991211" y="230">#eee</tspan>
                    </text>
                    <rect fill="#EEEEEE" x="300" y="59.1133005" width="271.625616" height="350.541872"></rect>
                </g>
            </svg>
            <style media="screen">
              #panels g {
                transition: 1s transform
              }
              #panels rect {
                transition: .5s fill
              }
            </style>
            <script type="text/javascript">
              var _win = document.querySelector('#panels g')

              for (var i = 0; i < 6; i++) {
                for (var j = 0; j < 5; j++) {

                  var clone = _win.cloneNode(true)
                  clone.style.transform = 'translate('+i*100+'px, '+j*90+'px) scale(0.14)'

                  _win.parentNode.appendChild(clone)

                }
              }
              _win.remove()
            </script>
          </section>
        </section>

        <section>
          <h2>/talk</h2>
        </section>

        <section data-background="#27343d" data-co="aa-start.txt">
          <h3>let's do this</h3>
          <h1><a href="#" class="cojs-link">cojs.co/?‚Ä¶</span></a></h1>
        </section>

        <section data-background="#27343d">
          <section>
            <h1>1. Drawing stuff</h1>
          </section>
          <section data-co="aa-draw.txt">
            <h3><a href="https://www.cojs.co/?independent">import {loop} from 'draw.js'</a></h3>

            <h4>
              <a href="javascript:populateCoJS('aa-draw-1.txt')">[1]</a>
              <a href="javascript:populateCoJS('aa-draw-2.txt')">[2]</a>
            </h4>
          </section>
        </section>

        <section>
          <section>
            <h2>I probably made some mistakes</h2>
            <h3>(Live-coding doesn't go to plan)</h3>
          </section>
          <section>
            <h2>"api"</h2>
            <h4>populating an editor from other sources</h4>
            <h5>(eg. a slide deck)</h5>
          </section>
        </section>

        <section data-background="#27343d">
          <section data-co="co-synth-43ea132.txt">
            <h1>2. WebAudio</h1>
          </section>

          <section>
            <h3>Audio graph</h3>
            <img src="img/webaudio-nodes.png" />
          </section>

          <section>
            <h5> &rarr; <a href="#" class="cojs-link">cojs.co/?‚Ä¶</span></a></h5>
          </section>

          <section data-co="co-synth-eed6d32.txt">
            start an Audio Context
          </section>

          <section data-co="co-synth-ceaa267.txt">
            add an Oscillator node
          </section>

          <section data-co="co-synth-574d824.txt">
            start and stop Oscillator node
          </section>

          <section data-co="co-synth-f8c2317.txt">
            now connect to audio context to play to the speakers
          </section>

          <section data-co="co-synth-9a11111.txt">
            wrap in function
          </section>

          <section data-co="co-synth-b4e037c.txt">
            move audio off to another module
          </section>

          <section data-co="co-synth-62907bf.txt">
            we add a frequency input
          </section>

          <section data-co="co-synth-253ffa5.txt">
            add a play button
          </section>

          <section data-co="co-synth-648d02b.txt">
            hook up interface
          </section>

          <section data-co="co-synth-dd1dbae.txt">
            extract as handler function
          </section>

          <section data-co="co-synth-ebbbf73.txt">
            extract form to module
          </section>

          <section data-co="co-synth-87962cf.txt">
            insert analyser <!--(Ruth will go into more detail later)-->
          </section>

          <section data-co="co-synth-0997ffe.txt">
            draw waveform
          </section>

          <section data-co="co-synth-029eb92.txt">
            implement drawWave
          </section>

          <section data-co="co-synth-eb86e4c.txt">
            draw on rAF
          </section>

          <section data-co="co-synth-4d83b79.txt">
            extract waveform to module
          </section>

          <!-- <section>
            <h1>440, 494, 523, 587</h1>
          </section> -->

          <section data-co="aa-synth-pusher.txt">
            <h3>+ keyboard</h3>
          </section>


        </section>


        <section data-background="#27343d">

          <section>
            <h1>3. Cubes</h1>
          </section>

          <section>
            <h2>CSS transforms</h2>
          </section>

          <section>
            <h3>transform: rotate(45deg) transform(100px, 50px)</h3>
          </section>

          <section data-co="co-cube-aefe75a.txt"> Cube </section>
          <section data-co="co-cube-e479972.txt"> start with some points </section>
          <section data-co="co-cube-eb95170.txt"> draw points </section>
          <section data-co="co-cube-49a2c51.txt"> implement draw points method </section>
          <section data-co="co-cube-37182b8.txt"> add a canvas/ctx </section>
          <section data-co="co-cube-9a13a29.txt"> extract canvas out </section>
          <section data-co="co-cube-b77787c.txt"> rotating the context, we can see blurryness </section>
          <section data-co="co-cube-77f644d.txt"> Make use of pixel ratio to scale down canvas </section>
          <section data-co="co-cube-1c1798e.txt"> add resize listener </section>
          <section data-co="co-cube-e87568c.txt"> use matrices </section>
          <section data-co="co-cube-1e71e48.txt"> introduce scale matrix </section>
          <section data-co="co-cube-5ed6fd6.txt"> add rotation matrix </section>
          <section data-co="co-cube-2892a3a.txt"> extract matrix generators </section>
          <section data-co="co-cube-7a5466e.txt"> animation loop </section>
          <section data-co="co-cube-76df535.txt"> extract animation loop out </section>
          <section data-co="co-cube-1462570.txt"> pull out transforms </section>
          <section data-co="co-cube-f593f12.txt"> combine matrices </section>
          <section data-co="co-cube-bdd5e2c.txt"> generate edges </section>
          <section data-co="co-cube-4822200.txt"> implement draw edges </section>
          <section data-co="co-cube-f82036b.txt"> call draw edges </section>
          <section data-co="co-cube-bf35391.txt"> clean up points </section>
          <section data-co="co-cube-ef86313.txt"> Extract drawEdges to draw.js </section>
          <section data-co="co-cube-21b545e.txt"> Update points and edges to be 3d (will break) </section>
          <section data-co="co-cube-ae2711a.txt"> update rotate matrices to be 3x3 </section>
          <section data-co="co-cube-5d78568.txt"> Add x,y,z matrices </section>
          <section data-co="co-cube-e5198fe.txt"> Utilise new rotation matrices </section>
          <section data-co="co-cube-9362b7f.txt"> homogeneous coordinates<br/>
          &amp; perspective transform </section>
          <section data-co="co-cube-ca18814.txt"> Let‚Äôs try VR - introduce an orientation </section>
          <section data-co="co-cube-bc5ed5a.txt"> populate from orientationevent </section>

        </section>

        <section>
          <section><h2>That probably didn't work</h2></section>
          <section>
            <h3>Screen orientation</h3>
            <h3>Gimble lock</h3>
            <h3>Implementations</h3>
            <h3>A hack</h3>
          </section>
          <section>
            <h2>WebVR - not a hack</h2>
          </section>
          <!-- <section>
            <h3>and more</h3>
            <h2>WebVR Polyfill doesn't use deviceorientation</h2>
          </section> -->
        </section>

        <!-- <section>
          <section>
            <h2>‚Ä¶lastly</h2>
          </section>
          <section>
            <h6>cardboctober.xyz</h6>
            <img src="img/cardboctober.png" />
          </section>
        </section> -->

        <section>
          <section>
            <h2>What <em>you've</em> done</h2>
            <h3>Drawn some stuff</h3>
            <h3>Used the web audio API</h3>
            <h3>Rendered a 3d wireframe</h3>
          </section>
          <section>
            <h1>üëè Well Done</h1>
          </section>
        </section>

        <section>
          <section>
            <h1>Get your hands dirty</h1>
            <h1 class="fragment">Share your work</h1>
            <h1 class="fragment">Let people help you</h1>
          </section>
        </section>


        <section>
          <h1>Thanks</h1>
          <h2>@benjaminbenben</h2>
          <h3><a href="http://pusher.com">pusher.com</a></h3>
        </section>


      </div>

    </div>

    <script src="bower_components/reveal.js/lib/js/head.min.js"></script>
    <script src="bower_components/reveal.js/js/reveal.js"></script>

    <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: false,
        progress: false,
        history: true,
        center: true,

        transition: 'slide', // none/fade/slide/convex/concave/zoom
        margin:0,

        // Optional reveal.js plugins
        dependencies: [
          { src: 'bower_components/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'bower_components/reveal.js/lib/js/zoom.js', condition: function() { return !document.body.classList; } },
          { src: 'bower_components/reveal.js/plugin/notes/notes.js', async: true },
          { src: 'bower_components/reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad({classPrefix:'tomorrow'}); } },

        ]
      });


      function populateCoJS(path) {
        fetch('code/' + path)
          .then(r => r.text())
          .then(text => {
            // console.log(text)
            fetch('https://www.cojs.co/api/content', {
              credentials: 'same-origin',
              method: 'PUT',
              headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                key: config.key,
                token: config.token,
                value: text
              })
            })
          })
      }


      Reveal.addEventListener( 'slidechanged', function( event ) {
        var slide = event.currentSlide
        if(slide.dataset.co) {
          populateCoJS(slide.dataset.co)
        }
      } )




      Array.from(document.querySelectorAll('[data-persist]'))
        .forEach( el => {
          var key = el.dataset.persist
          el.value = localStorage.getItem(key) || ''

          el.addEventListener('change', () => localStorage.setItem(key, el.value))
        })


      var config = {}
      function checkDeets(){
        config = JSON.parse(deets.value||'{}')

        // fetch('http://localhost:5000/api/check',
        fetch('https://www.cojs.co/api/check',
          {
              headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
              },
              method: "POST",
              body: deets.value
          })
          .then(function(res){
            if(res.status !== 200) {
              throw "deets error"
            }
          })
          .then(
            ok => document.body.classList.remove('deet-error'),
            notok => document.body.classList.add('deet-error')
          )

        Array.from(document.querySelectorAll('.cojs-link'))
          .forEach(a => {
            var link = 'https://www.cojs.co/?' + config.key
            var short = 'cojs.co?' + config.key

            a.href = link
            a.innerText = short
          })

      }
      checkDeets()
      deets.addEventListener('change', checkDeets)
    </script>

  </body>
</html>
