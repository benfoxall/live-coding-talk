<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>Live Coding</title>

    <meta name="description" content="A talk about stuff">
    <meta name="author" content="Ben Foxall (@benjaminbenben)">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link href="https://fonts.googleapis.com/css?family=Fredoka+One" rel="stylesheet">

    <link rel="stylesheet" href="bower_components/reveal.js/css/reveal.css">
    <link rel="stylesheet" href="theme/pusher.css" id="theme">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="bower_components/reveal.js/lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'bower_components/reveal.js/css/print/pdf.css' : 'bower_components/reveal.js/css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->

    <style media="screen">
      .deet-error {
        border-top: 3vh solid red
      }
    </style>

  </head>

  <body>

    <div class="reveal">

      <div class="slides">

        <section>
          <h3>…</h3>
          <p>
            <a href="https://www.cojs.co/api/details">deets &rarr;</a>
            <input type="txt" id="deets" value="" data-persist="deets" style="font-size:1em">
          </p>
        </section>

        <section>
          <section>
            <h1>Hello, I'm Ben</h1>
            <h5><a href="https://twitter.com/benjaminbenben">@benjaminbenben</a></h5>
          </section>

          <section data-background="#27343d">
            <img src="img/pusher_logo_white.svg" class="stretch" />
          </section>

          <section>
            <img src="img/jsoxford.svg" class="stretch" />
          </section>

          <section>
            <img src="img/render.png" class="stretch" />
            <h4>render-conf.com</h4>
          </section>

        </section>

        <section>
          <h1>I'm not sure how this will sound  </h1>
        </section>

        <section>

          <section>
            <h1>Live Coding<br />Across Devices</h1>
          </section>

          <section>
            <h1>Live Coding</h1>
          </section>

          <section>
            <h2>Automatically evaluated code</h2>
          </section>

          <section>
            <h3>For efficiency, focus &amp; exploration</h3>
            <h4 class="fragment">Also, performance &amp; art</h4>
          </section>

          <section>
            <h1>Across Devices</h1>
          </section>

          <section>
            <h2>Executes on many devices</h2>
          </section>

          <section>
            <h3>For collaboration, testing, <br/>learning &amp; the hell of it</h3>
          </section>

        </section>

        <section>
          <h2>What we'll cover</h2>

          <h5 class="fragment">1. Building a web-based live editor</h5>
          <h5 class="fragment">2. Using the editor we just built</h5>

          <!-- <h5>Squares</h5>
          <h5>"Music"</h5>
          <h5>Cubes</h5>
          <h5>+VR</h5> -->

        </section>

        <section>

          <section>
            <h1>Part 1</h1>
            <h1>Building a web-based live editor</h1>
          </section>

          <section>
            <div class="image-4grid">
              <img src="img/example-codepen.png"/>
              <img src="img/example-jsbin.png"/>
              <img src="img/example-jsfiddle.png"/>
              <!-- <img src="img/example-requirebin.png"/> -->
            </div>
          </section>
          <style media="screen">
            .image-4grid img { width: 40%; }
          </style>

          <section>
            <img src="img/code-along.png" class="fit" />
          </section>

          <section>
            <h1>cojs.co</h1>
          </section>

          <section>
            <h2>Totes meta</h2>
            <a href="#" class="cojs-link">cojs.co/?…pan></a>
          </section>

        </section>

        <section>

          <section>
            <h1>Challenges</h1>
          </section>

          <section>
            <img src="img/code-along-diagram.png" class="fit" />
          </section>

          <section>
            <h3>Making a textarea feel nice</h3>
            <h3>Building JavaScripts</h3>
            <h3>Module loading</h3>
            <h3>Injection</h3>
          </section>

        </section>

        <section>
          <section>
            <h2>Challenge</h2>
            <h1>Making a textarea feel nice</h1>
          </section>

          <section>
            <img src="img/textarea.png" class="fit" />
          </section>

          <section>
            <ul>
              <li>Ace Editor</li>
              <li>Monaco</li>
              <li>CodeMirror</li>
              <li>…</li>
              <li>Atom</li>
              <li>Hyperterm</li>
            </ul>
          </section>

          <section>
            <img src="img/codemirror.png" class="fit" />
          </section>

          <section>
            <pre><code>CodeMirror.fromTextArea(source)

// and tonnes more</code></pre>
          </section>

        </section>


        <section>
          <section>
            <h2>Challenge</h2>
            <h1>Building Javascripts</h1>
          </section>

          <section>
            <pre><code>const hey = you => console.log(`HELLO ${you}`)</code></pre>
          </section>

          <section>
            <h1>Tracuer</h1>
            <h1>Babel</h1>
            <h1>Bublé</h1>
          </section>

          <section>
            <h3>cojs.co uses Bublé</h3>
            <ul>
              <li>inspired by Babel</li>
              <li>no shims / polyfills</li>
              <li>simple transforms only</li>
              <li>fast</li>
              <li>less extensibility</li>
              <li>node &rarr; browser</li>
            </ul>
          </section>

          <section>
            <pre><code>buble.transform(source.value).code</code></pre>
          </section>

          <section data-co="bo-es6.txt">
            <h1>⚡️</h1>
          </section>

        </section>

        <section>
          <section>
            <h2>Challenge</h2>
            <h1>Module Loading</h1>
            <h4>Because sometimes we have more than one script</h4>
          </section>

          <section>
            <pre><code>// commonjs
const utils = require('utils')
utils.say('yeah!')


// ES2015 modules
import {say} from 'utils'
say('yeah!')</code></pre>
          </section>

          <section>
            <h1>Webpack</h1>
            <h1>Browserify</h1>
            <h1>Rollup</h1>
          </section>

          <section>
            <h3>cojs.co uses Rollup</h3>
            <ul>
              <li>embracing ES2015 modules</li>
              <li>minimal code-rewriting</li>
              <li>tree shaking</li>
              <li>d3, THREE.js</li>
            </ul>
          </section>

          <section data-co="bo-module-loading.txt">
            <h1>⚡️</h1>
          </section>

        </section>


        <section>
          <section>
            <h2>Challenge</h2>
            <h1>Injecting</h1>
            <p>(normal answer: upload it somewhere)</p>
          </section>

          <section>
            <h2>Option 1.</h2>
            <h1>"upload" to Service Worker</h1>
          </section>

          <section>
            <h3>Service workers</h3>
            <ul>
              <li>trendy</li>
              <li>cool</li>
              <li>persistant urls</li>
              <li>overkill possibly</li>
              <li>support is … <em>positive?</em></li>
              <li>really cool</li>
            </ul>
          </section>


          <section>
            <h2>Option 2.</h2>
            <h1>Data URIs</h1>
          </section>

          <section>
            <h3>data:[&lt;mediatype&gt;][;base64],&lt;data&gt;</h3>
          </section>

          <section>
            <h2><a href="data:text/html,<h1>Hello!">data:text/html,&lt;h1&gt;Hello!</a></h2>
          </section>

          <section data-co="bo-data-uri.txt">
            <h1>⚡️</h1>
          </section>

          <section>
            <pre><code>iframe.src = 'data:text/html;charset=utf-8,'+
 '%3Cbody%3E%3Cscript%3E' +
 encodeURI(source.value) +
 '%3C/script%3E'</code></pre>
          </section>

          <section>
            <h3>data-uris</h3>
            <ul>
              <li>lack of error handling</li>
              <li>length limitations</li>
              <li>random encoding issues</li>
              <li>a JS String object</li>
              <li>restrictions…</li>
            </ul>
          </section>

          <section>
            <img src="img/btoa.png" />
          </section>


          <section>
            <h2>Option 3.</h2>
            <h1>Blob URIs</h1>
          </section>

          <section>
            <h3 style="text-align:left">b = new Blob(['…'], {type: 'text/html'})</h3>
            <h3 style="text-align:left" class="fragment">url = URL.createObjectURL(b)</h3>
            <h3 style="text-align:left" class="fragment">// "blob:https%3A/…/208…abcec02"</h3>
          </section>

          <section data-co="bo-blob-uri.txt">
            <h1>⚡️</h1>
          </section>

          <section>
            <pre><code>iframe.src = URL.createObjectURL(blob)</code></pre>
          </section>

          <section>
            <ul>
              <li>not stored on the stack</li>
              <li>safe, and lots of control</li>
              <li>sounds cool</li>
            </ul>
          </section>

        </section>


        <section>
          <h2>~~~~~ Challenges ~~~~~</h2>
          <h3>Making a textarea feel nice</h3>
          <h3>Building JavaScripts</h3>
          <h3>Module loading</h3>
          <h3>Injection</h3>
        </section>


        <section>
          <section><h1>Why</h1></section>

          <section>
            <h1>1. multi-device development</h1>
          </section>
          <section>
            <h1>2. social coding</h1>
          </section>
          <section>
            <h1>3. workshops/talks</h1>
          </section>

        </section>


        <section>
          <h1>Part 2</h1>
          <h2>Using the editor we just built</h2>
        </section>

        <section>
          <h2><a href="#" class="cojs-link">cojs.co/?…</span></a></h2>
        </section>


        <section data-background="#27343d">
          <section>
            <h1>Synth</h1>
          </section>

          <section data-co="co-synth-43ea132.txt">
            start of synth demo
          </section>

          <section data-co="co-synth-eed6d32.txt">
            create an audio context
          </section>

          <section data-co="co-synth-ceaa267.txt">
            add an Oscillator node
          </section>

          <section data-co="co-synth-574d824.txt">
            start and stop Oscillator node
          </section>

          <section data-co="co-synth-f8c2317.txt">
            now connect to audio context to play to the speakers
          </section>

          <section data-co="co-synth-9a11111.txt">
            wrap in function
          </section>

          <section data-co="co-synth-b4e037c.txt">
            move audio off to another module
          </section>

          <section data-co="co-synth-62907bf.txt">
            we add a frequency input
          </section>

          <section data-co="co-synth-253ffa5.txt">
            add a play button
          </section>

          <section data-co="co-synth-648d02b.txt">
            hook up interface
          </section>

          <section data-co="co-synth-dd1dbae.txt">
            extract as handler function
          </section>

          <section data-co="co-synth-ebbbf73.txt">
            extract form to module
          </section>

          <section data-co="co-synth-87962cf.txt">
            insert analyser <!--(Ruth will go into more detail later)-->
          </section>

          <section data-co="co-synth-0997ffe.txt">
            draw waveform
          </section>

          <section data-co="co-synth-029eb92.txt">
            implement drawWave
          </section>

          <section data-co="co-synth-eb86e4c.txt">
            draw on rAF
          </section>

          <section data-co="co-synth-4d83b79.txt">
            extract waveform to module
          </section>

          <section>
            <h1>440, 494, 523, 587</h1>
          </section>

          <section>
            note to self:
<pre><code>new Pusher('dc6a0545f9f460f6c5e1', {cluster: 'eu', encrypted: true})
pusher.subscribe('midi')
  .bind('message', (m) => {
    const f = noteToFrequency(m[1])

  if(m[0]==144)
    synth.triggerAttack(f)

note => 440 * Math.pow(2, (note-49)/12)
</code></pre>

          </section>


        </section>


        <section data-background="#27343d">
          <section>
            <h1>Cubes</h1>
          </section>

          <section data-co="co-cube-aefe75a.txt"> Cube </section>
          <section data-co="co-cube-e479972.txt"> start with some points </section>
          <section data-co="co-cube-eb95170.txt"> draw points </section>
          <section data-co="co-cube-49a2c51.txt"> implement draw points method </section>
          <section data-co="co-cube-37182b8.txt"> add a canvas/ctx </section>
          <section data-co="co-cube-9a13a29.txt"> extract canvas out </section>
          <section data-co="co-cube-b77787c.txt"> rotating the context, we can see blurryness </section>
          <section data-co="co-cube-77f644d.txt"> Make use of pixel ratio to scale down canvas </section>
          <section data-co="co-cube-1c1798e.txt"> add resize listener </section>
          <section data-co="co-cube-e87568c.txt"> use matrices </section>
          <section data-co="co-cube-1e71e48.txt"> introduce scale matrix </section>
          <section data-co="co-cube-5ed6fd6.txt"> add rotation matrix </section>
          <section data-co="co-cube-2892a3a.txt"> extract matrix generators </section>
          <section data-co="co-cube-7a5466e.txt"> animation loop </section>
          <section data-co="co-cube-76df535.txt"> extract animation loop out </section>
          <section data-co="co-cube-1462570.txt"> pull out transforms </section>
          <section data-co="co-cube-f593f12.txt"> combine matrices </section>
          <section data-co="co-cube-bdd5e2c.txt"> generate edges </section>
          <section data-co="co-cube-4822200.txt"> implement draw edges </section>
          <section data-co="co-cube-f82036b.txt"> call draw edges </section>
          <section data-co="co-cube-bf35391.txt"> clean up points </section>
          <section data-co="co-cube-ef86313.txt"> Extract drawEdges to draw.js </section>
          <section data-co="co-cube-21b545e.txt"> Update points and edges to be 3d (will break) </section>
          <section data-co="co-cube-ae2711a.txt"> update rotate matrices to be 3x3 </section>
          <section data-co="co-cube-5d78568.txt"> Add x,y,z matrices </section>
          <section data-co="co-cube-e5198fe.txt"> Utilise new rotation matrices </section>
          <section data-co="co-cube-9362b7f.txt"> Add in a perspective mapper (pM.(v3->v4))->v3 </section>
          <section data-co="co-cube-ca18814.txt"> Let’s talk VR - bring in a rotation </section>
          <section data-co="co-cube-bc5ed5a.txt"> Populate that rotation from event </section>

        </section>

        <section>
          <section><h2>That probably didn't work</h2></section>
          <section>
            <h3>Screen orientation</h3>
            <h3>Differences in implementation/standard</h3>
            <h3>Gimble lock</h3>
            <h3>Sketchy coding</h3>
          </section>
          <section>
            <h2>WebVR will fix this</h2>
            <pre><code>navigator.getVRDisplays().then( displays =>
  displays[0].getFrameData(…)</code></pre>
          </section>
          <section>
            <h3>and more</h3>
            <h2>WebVR Polyfill doesn't use deviceorientation</h2>
          </section>
        </section>

        <section>
          <section>
            <h2>…lastly</h2>
          </section>
          <section>
            <h6>cardboctober.xyz</h6>
            <img src="img/cardboctober.png" />
          </section>
        </section>


        <section>
          <h1>Thanks</h1>
          <h2>@benjaminbenben</h2>
        </section>

      </div>

    </div>

    <script src="bower_components/reveal.js/lib/js/head.min.js"></script>
    <script src="bower_components/reveal.js/js/reveal.js"></script>

    <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: false,
        progress: false,
        history: true,
        center: true,

        transition: 'slide', // none/fade/slide/convex/concave/zoom
        margin:0,

        // Optional reveal.js plugins
        dependencies: [
          { src: 'bower_components/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'bower_components/reveal.js/lib/js/zoom.js', condition: function() { return !document.body.classList; } },
          { src: 'bower_components/reveal.js/plugin/notes/notes.js', async: true },
          { src: 'bower_components/reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },

        ]
      });


      Reveal.addEventListener( 'slidechanged', function( event ) {
        var slide = event.currentSlide
        if(slide.dataset.co) {
          console.log("YES " + slide.dataset.co)

          fetch('code/' + slide.dataset.co)
            .then(r => r.text())
            .then(text => {
              console.log(text)
              fetch('https://www.cojs.co/api/content', {
                credentials: 'same-origin',
                method: 'PUT',
                headers: {
                  'Accept': 'application/json',
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  key: config.key,
                  token: config.token,
                  value: text
                })
              })
            })

        }

          // event.previousSlide, event.currentSlide, event.indexh, event.indexv
      } )




      Array.from(document.querySelectorAll('[data-persist]'))
        .forEach( el => {
          var key = el.dataset.persist
          el.value = localStorage.getItem(key) || ''

          el.addEventListener('change', () => localStorage.setItem(key, el.value))
        })


      var config = {}
      function checkDeets(){
        config = JSON.parse(deets.value||'{}')

        // fetch('http://localhost:5000/api/check',
        fetch('https://www.cojs.co/api/check',
          {
              headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
              },
              method: "POST",
              body: deets.value
          })
          .then(function(res){
            if(res.status !== 200) {
              throw "deets error"
            }
          })
          .then(
            ok => document.body.classList.remove('deet-error'),
            notok => document.body.classList.add('deet-error')
          )

        Array.from(document.querySelectorAll('.cojs-link'))
          .forEach(a => {
            var link = 'https://www.cojs.co/?' + config.key
            var short = 'cojs.co?' + config.key

            a.href = link
            a.innerText = short
          })

      }
      checkDeets()
      deets.addEventListener('change', checkDeets)
    </script>

  </body>
</html>
